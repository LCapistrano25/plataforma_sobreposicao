{% comment %} 
  Componente: Resultados por Base de Dados
  Objetivo: Renderizar os resultados de sobreposi√ß√£o agrupados por cada base de dados.
  Estrutura esperada (do backend):
    - resultado.resultados_por_base: lista de objetos de base
      - cada base_resultado cont√©m:
        - nome_base: nome da base
        - areas_encontradas: lista de dicion√°rios de √°reas encontradas
        - total_areas_com_sobreposicao: contagem de √°reas encontradas
    - Cada item em areas_encontradas pode ter chaves diferentes conforme a base:
        - Im√≥veis (SICAR/CAR): area, item_info (e.g., "CAR: <num>"), status
        - Zoneamento: area, item_info (cont√©m texto com "Zonemaento")
        - Fitoecologias: area, item_info (cont√©m texto com "FitoEcolog")
        - APAs: area, unidade, dominios, classe, fundo_legal
  Decis√£o de componente:
    - Baseada nos campos presentes em cada √°rea (detec√ß√£o robusta sem depender estritamente do nome_base).
    - Fallback para componente gen√©rico quando nenhuma regra espec√≠fica se aplica. 
{% endcomment %}

{% if resultado.resultados_por_base %}
    {# Se houver pelo menos uma base para iterar, mostramos o t√≠tulo e iteramos pelas bases #}
    <h3>üéØ Resultados por Base de Dados:</h3>
    {% for base_resultado in resultado.resultados_por_base %}
    <div class="base-resultado">
        <h4>{{ base_resultado.nome_base }}</h4>
        {% if base_resultado.areas_encontradas %}
            {# Caso a base tenha √°reas encontradas, mostramos a contagem e iteramos por cada √°rea #}
            <p><strong>Sobreposi√ß√µes encontradas: {{ base_resultado.total_areas_com_sobreposicao }}</strong></p>
            {% for area in base_resultado.areas_encontradas %}
                {% comment %} {#
                  Sele√ß√£o do componente por base via campos:
                    - APAs: presen√ßa de qualquer um dos campos espec√≠ficos (unidade/dom√≠nios/classe/fundo_legal)
                    - Im√≥veis (SICAR/CAR): presen√ßa de status
                    - Zoneamento: item_info contendo "zonemaento"
                    - Fitoecologias: item_info contendo "fitoecolog"
                    - Gen√©rico: nenhuma das condi√ß√µes acima
                #} {% endcomment %}
                {% if area.unidade or area.dominios or area.classe or area.fundo_legal %}
                    {# APA: exibe detalhes espec√≠ficos (unidade, dom√≠nios, classe, fundo legal) #}
                    {% include "homepage/components/base/_area_item_apas.html" %}
                {% elif area.status %}
                    {# Im√≥veis (SICAR/CAR): exibe √°rea, info e status #}
                    {% include "homepage/components/base/_area_item_imoveis.html" %}
                {% elif area.item_info and 'zonemaento' in area.item_info|lower %}
                    {# Zoneamento: exibe √°rea e descri√ß√£o do zoneamento em item_info #}
                    {% include "homepage/components/base/_area_item_zoneamento.html" %}
                {% elif area.item_info and 'fitoecolog' in area.item_info|lower %}
                    {# Fitoecologias: exibe √°rea e descri√ß√£o da fitoecologia em item_info #}
                    {% include "homepage/components/base/_area_item_fitoecologias.html" %}
                {% else %}
                    {# Fallback gen√©rico: exibe campos comuns (√°rea e item_info) #}
                    {% include "homepage/components/_area_item.html" %}
                {% endif %}
            {% endfor %}
        {% else %}
            {# Mensagem por base: esta base espec√≠fica n√£o possui √°reas com sobreposi√ß√£o #}
            <p>‚úÖ Nenhuma sobreposi√ß√£o encontrada nesta base de dados.</p>
        {% endif %}
    </div>
    {% endfor %}
{% else %}
    {# Mensagem global: n√£o h√° nenhuma base para iterar ou lista vazia #}
    {% include "homepage/components/_sem_sobreposicao_global.html" %}
{% endif %}